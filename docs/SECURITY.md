# セキュリティに関する説明

## 1. 外部の人からアクセスされることはありますか？

### 現状の保護

- **ログイン必須**: ダッシュボード（`/`）と連絡・ファイル解析（`/slack-analyzer`）は、**ユーザー名とパスワードでログインしないと中身を見られません**。
- **ログインしていない人**: URL を知っていても、ログイン画面までしか表示されず、KPI・チェックリスト・タスクなどは見えません。
- **API**: 連絡・ファイル解析の API（`/api/slack-analyze`）も認証済みユーザー以外には 401 を返すため、未認証では利用できません。

### 注意点（外部アクセスのリスク）

| リスク | 説明 | 対策の目安 |
|--------|------|-------------|
| **URL の漏れ** | 本番 URL が外部に知られると、誰でもログイン**画面**にはアクセスできます。中身はパスワードがないと見れません。 | URL は社内のみ共有し、公開サイトや SNS に載せない。 |
| **パスワードの弱さ** | 推測されやすいパスワードだと、総当たりや漏れで突破される可能性があります。 | 長く複雑なパスワード（英数字・記号）を使う。定期的に変更する。 |
| **認証情報の共有** | ユーザー名・パスワードを社外に教えると、その人が「社内の人」としてログインできてしまいます。 | 認証情報は必要最小限の社内メンバーのみに共有する。 |

**結論**:  
「外部の人が URL だけ知っている」状態では、**ログイン画面までしか開けず、システム上の情報は見られません**。  
「外部の人が URL とユーザー名・パスワードの両方を持っている」場合はアクセスできてしまうので、**URL と認証情報の両方を社外に漏らさない運用**が重要です。

---

## 2. システム上の情報が外部に流出することはありますか？

### データの置き場所（現状）

- **KPI・チェックリスト・タスクボードなど**:  
  現状は **ブラウザのメモリ（React の state）のみ**で、サーバー側のデータベースには保存していません。  
  - ページを閉じたりログアウトしたりすると、その端末上の表示は消えます。  
  - サーバーに「顧客リストや KPI がファイルとして保存されている」ような仕組みはありません（その分、サーバーが乗っ取られても DB から情報が抜かれるリスクはありません）。

### 外部に送信されるデータ（連絡・ファイル解析を使う場合）

- **通常運用（OpenAI 利用）**: 入力したテキスト・PDF・画像を **OpenAI の API に送って**解析しています。  
  - その間、**その内容は OpenAI のサーバーに送られます**。  
  - OpenAI の利用規約・データ取り扱い方針（学習用に使うかどうかなど）は、[OpenAI の公式説明](https://openai.com/policies)で確認してください。  
  - 機密性の高い文書（個人情報・契約書・戦略資料など）を解析に載せる場合は、**社内の情報管理ポリシーや OpenAI のデータポリシーを確認したうえで**利用することを推奨します。

- **クローズド運用（入力情報を外部に出したくない場合）**  
  - 環境変数 **`CLOSED_AI_MODE=true`** にすると、**OpenAI を一切呼びません**。  
  - テキスト・PDF はサーバー内で抽出のみ行い、**画像の AI 解析は行いません**。抽出したテキストは画面に表示するだけで、外部には送信されません。  
  - 入力情報が外部に流れることを完全に阻止したい場合は、この設定を有効にしてください。

- **自社内 AI（ローカル / オンプレ）で解析したい場合**  
  - 環境変数 **`LOCAL_AI_BASE_URL`** に、自社サーバー上の **OpenAI 互換 API**（例: [Ollama](https://ollama.com)、[LocalAI](https://localai.io) 等）のベース URL を設定できます。  
  - 設定時は、解析リクエストは **その URL にのみ**送られ、OpenAI には送りません。データは自社内に留まります。  
  - 自社サーバーや VPN 内にモデルを立て、その URL を指定する運用にすると、外部クラウドへデータを送らずに AI 解析が可能です。

### その他の通信

- ログインや API の通信は、Vercel では **HTTPS** で行われます（通信内容は暗号化されます）。  
- セッションは NextAuth の JWT（Cookie）で管理しており、**Cookie は HttpOnly 等の一般的なセキュリティ設定**に沿った形で利用されています。

**結論**:  
- **「このシステムのサーバーから、顧客名簿や KPI がまとめて外部に送られている」ような仕組みはありません。**  
- **連絡・ファイル解析**について:  
  - **通常**: 入力したテキスト・PDF・画像は OpenAI に送信されます。機密性の高い情報は載せない／載せる前に社内ポリシーと OpenAI のポリシーを確認する運用が望ましいです。  
  - **入力情報を外部に出したくない場合**: `CLOSED_AI_MODE=true` にすると外部 API は一切呼ばず、テキスト・PDF の抽出のみ行います（画像の AI 解析は行いません）。  
  - **自社内で AI 解析したい場合**: `LOCAL_AI_BASE_URL` に自社の OpenAI 互換 API の URL を設定すると、そのサーバーにのみ送信され、OpenAI には送りません。

---

## 3. まとめと推奨事項

| 質問 | 回答 |
|------|------|
| 外部の人からアクセスされるか？ | **ログインしていない限り、中身は見られません。** URL とパスワードの両方を社外に漏らさないことが重要です。 |
| 情報が外部に流出するか？ | **KPI・チェックリストなどはサーバーの DB に保存しておらず、そのまま外部に送る仕組みもありません。** 連絡・ファイル解析は、通常時は入力内容が OpenAI に送信されます。`CLOSED_AI_MODE=true` または `LOCAL_AI_BASE_URL` を設定すると、入力情報を外部（OpenAI）に送らずに運用できます。 |

### 推奨する運用

1. **URL は社内限定**: 本番 URL を社外や公開場所に載せない。  
2. **強いパスワード**: 長く複雑なパスワードを設定し、定期的に変更する。  
3. **認証情報の管理**: ユーザー名・パスワードは必要最小限の人数にだけ共有する。  
4. **機密情報と連絡・ファイル解析**: 機密性の高い文書は解析機能に載せない、または載せる前に情報管理ポリシーと OpenAI のポリシーを確認する。**入力情報を外部に出したくない場合は `CLOSED_AI_MODE=true` でクローズド運用、または `LOCAL_AI_BASE_URL` で自社内 AI を利用する。**  
5. **Vercel の環境変数**: `NEXTAUTH_SECRET`・`AUTH_USERNAME`・`AUTH_PASSWORD` を外部に漏らさない（Vercel の環境変数はプロジェクトメンバーにのみ見える設定にしておく）。

さらに制限をかけたい場合は、Vercel の **Password Protection**（プロジェクト単位のパスワード）の併用や、**VPN・IP 制限**のできる社内専用サーバーへのデプロイなども検討できます。
